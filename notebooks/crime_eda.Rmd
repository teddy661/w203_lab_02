---
title: "Crime_Dataset_EDA"
author: "the_principal_components"
date: "`r Sys.Date()`"
output: pdf_document
header-includes:
 \usepackage{wrapfig}
 \usepackage{float}
 \floatplacement{figure}{H}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r check packages and install, include=FALSE}
if(!require("Hmisc")){install.packages('Hmisc')}
if(!require("funModeling")){install.packages('funModeling')}
```
```{r load packages and set options, include=FALSE}

library(tidyverse) 
library(stargazer)
library(sandwich)
library(lmtest)
library(Hmisc)
library(funModeling)
library(olsrr)

theme_set(theme_bw())
```

```{r load data, message = FALSE, include=FALSE}
communities <- read.csv("../datasets/communities_with_headers.csv",  header = TRUE)
#communities <- read.arff("../datasets/communities.arff")
```

```{r check correlations}
correlation_table(data=communities, target="ViolentCrimesPerPop")
```

```{r plots positive correlation, message = FALSE, include=FALSE}
ggplot(communities, aes(x=PctIlleg, y=ViolentCrimesPerPop)) + 
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=pctWPubAsst, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctPopUnderPov, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctUnemployed, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=racepctblack, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctVacantBoarded, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctHousNoPhone, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=FemalePctDiv, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctLargHouseFam, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=TotalPctDiv, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctPolicBlack, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctPolicMinor, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=MalePctDivorce, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=NumIlleg, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctLargHouseOccup, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctWOFullPlumb, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
```
```{r plots negative correlation, message = FALSE, include=FALSE}
ggplot(communities, aes(x=medFamInc, y=ViolentCrimesPerPop)) + 
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=pctWInvInc, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=racePctWhite, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctYoungKids2Par, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctFam2Par, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctTeen2Par, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctKids2Par, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
```
```{r plots selected variables}
ggplot(communities, aes(x=PctPopUnderPov, y=ViolentCrimesPerPop)) + 
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctPopUnderPov)) + 
  geom_histogram(bins=60)
ggplot(communities, aes(x=TotalPctDiv, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=TotalPctDiv)) + 
  geom_histogram(bins=60)
ggplot(communities, aes(x=PolicPerPop, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PolicPerPop)) + 
  geom_histogram(bins=60)
ggplot(communities, aes(x=PctFam2Par, y=ViolentCrimesPerPop)) +
  geom_point()+
  geom_smooth(method=lm)
ggplot(communities, aes(x=PctFam2Par)) + 
  geom_histogram(bins=60)
```
```{r fits }
fit_01 <- communities %>% lm(ViolentCrimesPerPop ~ PctPopUnderPov + TotalPctDiv + PolicPerPop + PctFam2Par, data = .)
fit_01_se <- fit_01 %>% vcovHC(type = "HC1") %>% diag() %>% sqrt()
stargazer(fit_01, type="text",se = list(fit_01_se))
coeftest(fit_01, vconv = vcovHC(type = "HC1"))
fit_o1_vif = ols_vif_tol(fit_01)
```